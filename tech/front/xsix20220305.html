<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AntV X6源码简析 | VLeeDesignTheory</title>
    <meta name="description" content="The Intersection of Technology and Liberal Arts">
    <meta name="generator" content="VuePress 1.3.0">
    <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.ba29e539.css" as="style"><link rel="preload" href="/assets/js/app.8be0e0a6.js" as="script"><link rel="preload" href="/assets/js/2.984c461b.js" as="script"><link rel="preload" href="/assets/js/88.a6b02ad4.js" as="script"><link rel="prefetch" href="/assets/js/10.5cc39d1d.js"><link rel="prefetch" href="/assets/js/11.15cdb43e.js"><link rel="prefetch" href="/assets/js/12.06485937.js"><link rel="prefetch" href="/assets/js/13.472a2c29.js"><link rel="prefetch" href="/assets/js/14.d79a8704.js"><link rel="prefetch" href="/assets/js/15.61ac7c95.js"><link rel="prefetch" href="/assets/js/16.40e0624d.js"><link rel="prefetch" href="/assets/js/17.6d266b01.js"><link rel="prefetch" href="/assets/js/18.179e71a3.js"><link rel="prefetch" href="/assets/js/19.57b341aa.js"><link rel="prefetch" href="/assets/js/20.e9181ec2.js"><link rel="prefetch" href="/assets/js/21.064d76f4.js"><link rel="prefetch" href="/assets/js/22.03ef9be6.js"><link rel="prefetch" href="/assets/js/23.d8d3a89f.js"><link rel="prefetch" href="/assets/js/24.46d5ce43.js"><link rel="prefetch" href="/assets/js/25.e66d6d88.js"><link rel="prefetch" href="/assets/js/26.ffd8da2f.js"><link rel="prefetch" href="/assets/js/27.20da1fa0.js"><link rel="prefetch" href="/assets/js/28.5517996d.js"><link rel="prefetch" href="/assets/js/29.f6af6fbb.js"><link rel="prefetch" href="/assets/js/3.7b51d13c.js"><link rel="prefetch" href="/assets/js/30.fd905aa4.js"><link rel="prefetch" href="/assets/js/31.4d155fb1.js"><link rel="prefetch" href="/assets/js/32.daa14379.js"><link rel="prefetch" href="/assets/js/33.0c565322.js"><link rel="prefetch" href="/assets/js/34.a2469f4a.js"><link rel="prefetch" href="/assets/js/35.fe1e331d.js"><link rel="prefetch" href="/assets/js/36.acad7212.js"><link rel="prefetch" href="/assets/js/37.4be4688b.js"><link rel="prefetch" href="/assets/js/38.0ce5462f.js"><link rel="prefetch" href="/assets/js/39.eea49bbe.js"><link rel="prefetch" href="/assets/js/4.32c38324.js"><link rel="prefetch" href="/assets/js/40.909ed412.js"><link rel="prefetch" href="/assets/js/41.7b0f5165.js"><link rel="prefetch" href="/assets/js/42.c5847540.js"><link rel="prefetch" href="/assets/js/43.14eedcb7.js"><link rel="prefetch" href="/assets/js/44.40ed4222.js"><link rel="prefetch" href="/assets/js/45.29388d40.js"><link rel="prefetch" href="/assets/js/46.55b8a16d.js"><link rel="prefetch" href="/assets/js/47.668da14a.js"><link rel="prefetch" href="/assets/js/48.7cb06dcc.js"><link rel="prefetch" href="/assets/js/49.491d89f5.js"><link rel="prefetch" href="/assets/js/5.18d31a6e.js"><link rel="prefetch" href="/assets/js/50.1715183e.js"><link rel="prefetch" href="/assets/js/51.eb1ceda0.js"><link rel="prefetch" href="/assets/js/52.ab59a948.js"><link rel="prefetch" href="/assets/js/53.52dd242c.js"><link rel="prefetch" href="/assets/js/54.6a6a6edf.js"><link rel="prefetch" href="/assets/js/55.90a2d17a.js"><link rel="prefetch" href="/assets/js/56.e1281c58.js"><link rel="prefetch" href="/assets/js/57.d900cb38.js"><link rel="prefetch" href="/assets/js/58.4574e3c3.js"><link rel="prefetch" href="/assets/js/59.5f46f092.js"><link rel="prefetch" href="/assets/js/6.886d04e6.js"><link rel="prefetch" href="/assets/js/60.4fd77246.js"><link rel="prefetch" href="/assets/js/61.03c6d11f.js"><link rel="prefetch" href="/assets/js/62.6c4a2003.js"><link rel="prefetch" href="/assets/js/63.0e6902b9.js"><link rel="prefetch" href="/assets/js/64.0b83a931.js"><link rel="prefetch" href="/assets/js/65.96f2df30.js"><link rel="prefetch" href="/assets/js/66.744d9ab1.js"><link rel="prefetch" href="/assets/js/67.9837b758.js"><link rel="prefetch" href="/assets/js/68.dc9af8aa.js"><link rel="prefetch" href="/assets/js/69.445bac8e.js"><link rel="prefetch" href="/assets/js/7.fb7fa9c5.js"><link rel="prefetch" href="/assets/js/70.3c680b0e.js"><link rel="prefetch" href="/assets/js/71.4a662baa.js"><link rel="prefetch" href="/assets/js/72.1a286829.js"><link rel="prefetch" href="/assets/js/73.8d6b550c.js"><link rel="prefetch" href="/assets/js/74.fad5a0c5.js"><link rel="prefetch" href="/assets/js/75.0c5864ae.js"><link rel="prefetch" href="/assets/js/76.9a6ec209.js"><link rel="prefetch" href="/assets/js/77.8280bb93.js"><link rel="prefetch" href="/assets/js/78.3a2e4074.js"><link rel="prefetch" href="/assets/js/79.e18eb7f1.js"><link rel="prefetch" href="/assets/js/8.383d22ab.js"><link rel="prefetch" href="/assets/js/80.00c61c8a.js"><link rel="prefetch" href="/assets/js/81.8878bbce.js"><link rel="prefetch" href="/assets/js/82.f32b8403.js"><link rel="prefetch" href="/assets/js/83.c4c68d29.js"><link rel="prefetch" href="/assets/js/84.4edeeb08.js"><link rel="prefetch" href="/assets/js/85.e2c40980.js"><link rel="prefetch" href="/assets/js/86.cbdc4406.js"><link rel="prefetch" href="/assets/js/87.dd59cc6f.js"><link rel="prefetch" href="/assets/js/89.4edca4ad.js"><link rel="prefetch" href="/assets/js/9.842a26fc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ba29e539.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">VLeeDesignTheory</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计道" class="dropdown-title"><span class="title">设计道</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design/ui/" class="nav-link">
  交互
</a></li><li class="dropdown-item"><!----> <a href="/design/vi/" class="nav-link">
  视觉
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术栈" class="dropdown-title"><span class="title">技术栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tech/front/" class="nav-link router-link-active">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/tech/back/" class="nav-link">
  后端
</a></li><li class="dropdown-item"><!----> <a href="/tech/cs/" class="nav-link">
  基础
</a></li></ul></div></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试
</a></div><div class="nav-item"><a href="/essay/" class="nav-link">
  随笔
</a></div><div class="nav-item"><a href="https://github.com/we452366" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计道" class="dropdown-title"><span class="title">设计道</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design/ui/" class="nav-link">
  交互
</a></li><li class="dropdown-item"><!----> <a href="/design/vi/" class="nav-link">
  视觉
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术栈" class="dropdown-title"><span class="title">技术栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tech/front/" class="nav-link router-link-active">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/tech/back/" class="nav-link">
  后端
</a></li><li class="dropdown-item"><!----> <a href="/tech/cs/" class="nav-link">
  基础
</a></li></ul></div></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试
</a></div><div class="nav-item"><a href="/essay/" class="nav-link">
  随笔
</a></div><div class="nav-item"><a href="https://github.com/we452366" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech/front/summary.html" class="sidebar-link">从2019看2020前端发展趋势</a></li><li><a href="/tech/front/locales.html" class="sidebar-link">阿里飞冰(ice)框架下国际化实践</a></li><li><a href="/tech/front/tree20200531.html" class="sidebar-link">基础视频平台树组件踩坑实践</a></li><li><a href="/tech/front/range20200613.html" class="sidebar-link">基于el-slider自定义range组件封装实践</a></li><li><a href="/tech/front/hot20200620.html" class="sidebar-link">Vue脚手架热更新技术探秘</a></li><li><a href="/tech/front/tick20200625.html" class="sidebar-link">nextTick在项目中的实践</a></li><li><a href="/tech/front/cli20200701.html" class="sidebar-link">vee-cli脚手架实践(上)</a></li><li><a href="/tech/front/cli20200702.html" class="sidebar-link">vee-cli脚手架实践(中)</a></li><li><a href="/tech/front/cli20200703.html" class="sidebar-link">vee-cli脚手架实践(下)</a></li><li><a href="/tech/front/hooks20200826.html" class="sidebar-link">React Hooks在SD-WAN项目中实践</a></li><li><a href="/tech/front/flexiwan20201218.html" class="sidebar-link">flexiwan项目踩坑实践（前端篇）</a></li><li><a href="/tech/front/summary2020.html" class="sidebar-link">从2020看2021前端发展趋势</a></li><li><a href="/tech/front/federation20210119.html" class="sidebar-link">webpack5模块联邦源码探究</a></li><li><a href="/tech/front/topology20210122.html" class="sidebar-link">动态渲染拓扑图方案探究</a></li><li><a href="/tech/front/micro20210125.html" class="sidebar-link">几种微前端方案探究</a></li><li><a href="/tech/front/umi20210222.html" class="sidebar-link">umi3源码探究简析</a></li><li><a href="/tech/front/react20210305.html" class="sidebar-link">react17源码浅析</a></li><li><a href="/tech/front/screen20210402.html" class="sidebar-link">自服务大屏踩坑实践</a></li><li><a href="/tech/front/graph20210419.html" class="sidebar-link">可视化图布局算法浅析</a></li><li><a href="/tech/front/function20210427.html" class="sidebar-link">前端函数式编程浅析</a></li><li><a href="/tech/front/structure20210523.html" class="sidebar-link">数据结构算法在专网项目中的实践</a></li><li><a href="/tech/front/postmessage20210731.html" class="sidebar-link">postMessage踩坑实践</a></li><li><a href="/tech/front/csp20210813.html" class="sidebar-link">Web内容安全策略浅析</a></li><li><a href="/tech/front/pcx20211018.html" class="sidebar-link">PC端高倍屏适配方案实践</a></li><li><a href="/tech/front/summary2021.html" class="sidebar-link">从2021看2022前端发展趋势</a></li><li><a href="/tech/front/imagepic20220128.html" class="sidebar-link">前端图床搭建实践（前端篇）</a></li><li><a href="/tech/front/xsix20220305.html" class="active sidebar-link">AntV X6源码简析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/front/xsix20220305.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/tech/front/xsix20220305.html#架构" class="sidebar-link">架构</a></li><li class="sidebar-sub-header"><a href="/tech/front/xsix20220305.html#目录" class="sidebar-link">目录</a></li><li class="sidebar-sub-header"><a href="/tech/front/xsix20220305.html#源码" class="sidebar-link">源码</a></li><li class="sidebar-sub-header"><a href="/tech/front/xsix20220305.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/tech/front/xsix20220305.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/tech/front/testus20220420.html" class="sidebar-link">前端测试套件构建实践</a></li><li><a href="/tech/front/pnw20220608.html" class="sidebar-link">浅析专网通信领域的前端架构设计</a></li><li><a href="/tech/front/piper20220913.html" class="sidebar-link">前端设计走查平台实践（前端篇）</a></li><li><a href="/tech/front/summary2022.html" class="sidebar-link">从2022看2023前端发展趋势</a></li><li><a href="/tech/front/mpa20230217.html" class="sidebar-link">vue脚手架多页自动化生成实践</a></li><li><a href="/tech/front/gsix20230624.html" class="sidebar-link">AntV G6新版源码浅析</a></li><li><a href="/tech/front/pwa20230731.html" class="sidebar-link">面向边缘场景的PWA实践</a></li><li><a href="/tech/front/mock20230924.html" class="sidebar-link">基于 Webpack 插件体系的 Mock 服务</a></li><li><a href="/tech/front/summary2023.html" class="sidebar-link">从2023看2024前端发展趋势</a></li><li><a href="/tech/front/lcd20241024.html" class="sidebar-link">面向垂类场景的智能化低代码引擎</a></li><li><a href="/tech/front/summary2024.html" class="sidebar-link">从2024看2025前端发展趋势</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="antv-x6源码简析"><a href="#antv-x6源码简析" class="header-anchor">#</a> AntV X6源码简析</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p><a href="https://antv.vision" target="_blank" rel="noopener noreferrer">AntV<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是蚂蚁金服全新一代数据可视化解决方案，其中X6主要用于解决图编辑领域相关的解决方案，其是一款图编辑引擎，内置了一下编辑器所需的功能及组件等，本文旨在通过简要分析x6源码来对图编辑领域的一些底层引擎进行一个大致了解，同时也为团队中需要进行基于X6编辑引擎进行构建的图编辑器提供一些侧面了解，在碰到问题时可以较快的找到问题点。</p> <h2 id="架构"><a href="#架构" class="header-anchor">#</a> 架构</h2> <p><img src="/tech/front/xsix20220305/xsix01.png" alt="图片"></p> <p><img src="/tech/front/xsix20220305/xsix02.png" alt="图片"></p> <p>X6整体是基于MVVM的架构进行设计的，对外整体暴露Graph的类，其中的Node、Edge、Port等都有对外暴露的方法，可以单独使用，其中提供了类Jquery的一些dom操作方法，整体的Graph基于了一个事件基类，对事件进行的整体的处理，其中使用了dispose来对实例进行显示判定。</p> <p><img src="/tech/front/xsix20220305/xsix03.png" alt="图片"></p> <p><img src="/tech/front/xsix20220305/xsix04.png" alt="图片"></p> <p>整体设计符合<a href="https://zh.wikipedia.org/wiki/SOLID" target="_blank" rel="noopener noreferrer">SOLID原则<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，提供事件机制进行发布订阅解耦，对于扩展性结构则提供注册机制，进行扩展性插件组织</p> <h2 id="目录"><a href="#目录" class="header-anchor">#</a> 目录</h2> <p>整体采用monorepo进行源码的仓库管理</p> <ul><li>packages
<ul><li>x6
<ul><li>addon</li> <li>common</li> <li>geometry</li> <li>global</li> <li>graph</li> <li>layout</li> <li>model</li> <li>registry</li> <li>shape</li> <li>style</li> <li>types</li> <li>util</li> <li>view</li></ul></li> <li>x6-angular-shape</li> <li>x6-geometry
<ul><li>angle</li> <li>curve</li> <li>ellipse</li> <li>line</li> <li>point</li> <li>polyline</li> <li>rectangle</li></ul></li> <li>x6-react</li> <li>x6-react-components</li> <li>x6-react-shape</li> <li>x6-vector</li> <li>x6-vue-shape</li></ul></li></ul> <h2 id="源码"><a href="#源码" class="header-anchor">#</a> 源码</h2> <p>从架构层次可以看出，整体对外暴露的就是Graph这么一个大类，因而在分析源码调用过程中，我们抓住Graph进行逐步的往外拓展，从而把握整体的一个设计链路，避免陷入局部无法抽离</p> <h3 id="graph"><a href="#graph" class="header-anchor">#</a> Graph</h3> <p>Graph类提供了整体所有结构的汇总，从而暴露给用户</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Graph</span> <span class="token keyword">extends</span> <span class="token class-name">Basecoat</span><span class="token operator">&lt;</span>EventArgs<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> options<span class="token operator">:</span> GraphOptions<span class="token punctuation">.</span>Definition
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> css<span class="token operator">:</span> CSSManager
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> model<span class="token operator">:</span> Model
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> view<span class="token operator">:</span> GraphView
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> hook<span class="token operator">:</span> HookManager
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> grid<span class="token operator">:</span> Grid
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> defs<span class="token operator">:</span> Defs
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> knob<span class="token operator">:</span> Knob
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> coord<span class="token operator">:</span> Coord
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> renderer<span class="token operator">:</span> ViewRenderer
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> snapline<span class="token operator">:</span> Snapline
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> highlight<span class="token operator">:</span> Highlight
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> transform<span class="token operator">:</span> Transform
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> clipboard<span class="token operator">:</span> Clipboard
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> selection<span class="token operator">:</span> Selection
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> background<span class="token operator">:</span> Background
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> history<span class="token operator">:</span> History
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> scroller<span class="token operator">:</span> Scroller
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> minimap<span class="token operator">:</span> MiniMap
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> keyboard<span class="token operator">:</span> Shortcut
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> mousewheel<span class="token operator">:</span> Wheel
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> panning<span class="token operator">:</span> Panning
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> print<span class="token operator">:</span> Print
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> format<span class="token operator">:</span> Format
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> size<span class="token operator">:</span> SizeManager
  
  <span class="token comment">// 拿到需要加载的container</span>
  <span class="token keyword">public</span> <span class="token keyword">get</span> <span class="token function">container</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>container
  <span class="token punctuation">}</span>

  <span class="token keyword">protected</span> <span class="token keyword">get</span> <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Graph<span class="token punctuation">.</span>toStringTag
  <span class="token punctuation">}</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>GraphOptions<span class="token punctuation">.</span>Manual<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> GraphOptions<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>css <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CSSManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HookManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>view <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>defs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createDefsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>coord <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createCoordManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createTransformManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>knob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createKnobManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>highlight <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createHighlightManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createGridManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createBackgroundManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>renderer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>clipboard <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createClipboardManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>snapline <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createSnaplineManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>selection <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createSelectionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createHistoryManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>scroller <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createScrollerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>minimap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createMiniMapManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>keyboard <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createKeyboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mousewheel <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createMouseWheel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>print <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createPrintManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>format <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createFormatManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>panning <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createPanningManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">createSizeManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="shape"><a href="#shape" class="header-anchor">#</a> Shape</h3> <p>实现各种类型方法的中间解耦层，用于包裹属性等</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// shape的基类，标记shape的各种属性，如标签等</span>
<span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token operator">&lt;</span>
  Properties <span class="token keyword">extends</span> <span class="token class-name">Node<span class="token punctuation">.</span>Properties</span> <span class="token operator">=</span> Node<span class="token punctuation">.</span>Properties<span class="token punctuation">,</span>
<span class="token operator">&gt;</span> <span class="token keyword">extends</span> <span class="token class-name">Node</span><span class="token operator">&lt;</span>Properties<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">label</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLabel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">set</span> <span class="token function">label</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setLabel</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">getLabel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getAttrByPath<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">'text/text'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">setLabel</span><span class="token punctuation">(</span><span class="token parameter">label<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> Node<span class="token punctuation">.</span>SetOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>label <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeLabel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setAttrByPath</span><span class="token punctuation">(</span><span class="token string">'text/text'</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>

  <span class="token function">removeLabel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeAttrByPath</span><span class="token punctuation">(</span><span class="token string">'text/text'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// 创建shape的方法</span>
<span class="token keyword">function</span> <span class="token function">createShape</span><span class="token punctuation">(</span>
  <span class="token parameter">shape<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  config<span class="token operator">:</span> Node<span class="token punctuation">.</span>Config<span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    noText<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
    ignoreMarkup<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
    parent<span class="token operator">?</span><span class="token operator">:</span> Node<span class="token punctuation">.</span>Definition <span class="token operator">|</span> <span class="token keyword">typeof</span> Base
  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">getName</span><span class="token punctuation">(</span>shape<span class="token punctuation">)</span>
  <span class="token keyword">const</span> defaults<span class="token operator">:</span> Node<span class="token punctuation">.</span>Config <span class="token operator">=</span> <span class="token punctuation">{</span>
    constructorName<span class="token operator">:</span> name<span class="token punctuation">,</span>
    attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'.'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        fill<span class="token operator">:</span> <span class="token string">'#ffffff'</span><span class="token punctuation">,</span>
        stroke<span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>shape<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        fill<span class="token operator">:</span> <span class="token string">'#ffffff'</span><span class="token punctuation">,</span>
        stroke<span class="token operator">:</span> <span class="token string">'#000000'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>ignoreMarkup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    defaults<span class="token punctuation">.</span>markup <span class="token operator">=</span> <span class="token function">getMarkup</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> options<span class="token punctuation">.</span>noText <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> base <span class="token operator">=</span> options<span class="token punctuation">.</span>parent <span class="token operator">||</span> Base
  <span class="token keyword">return</span> base<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span>
    ObjectExt<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>defaults<span class="token punctuation">,</span> config<span class="token punctuation">,</span> <span class="token punctuation">{</span> shape<span class="token operator">:</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">typeof</span> Base
<span class="token punctuation">}</span>
</code></pre></div><h3 id="model"><a href="#model" class="header-anchor">#</a> Model</h3> <p>提供了Node、Cell、Edge、Prot等的处理方法</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Model</span> <span class="token keyword">extends</span> <span class="token class-name">Basecoat</span><span class="token operator">&lt;</span>Model<span class="token punctuation">.</span>EventArgs<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> collection<span class="token operator">:</span> Collection
  <span class="token keyword">protected</span> <span class="token keyword">readonly</span> batches<span class="token operator">:</span> KeyValue<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token keyword">readonly</span> addings<span class="token operator">:</span> WeakMap<span class="token operator">&lt;</span>Cell<span class="token punctuation">,</span> <span class="token builtin">boolean</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> graph<span class="token operator">:</span> Graph <span class="token operator">|</span> <span class="token keyword">null</span>
  <span class="token keyword">protected</span> nodes<span class="token operator">:</span> KeyValue<span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> edges<span class="token operator">:</span> KeyValue<span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> outgoings<span class="token operator">:</span> KeyValue<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> incomings<span class="token operator">:</span> KeyValue<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">protected</span> <span class="token keyword">get</span> <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Model<span class="token punctuation">.</span>toStringTag
  <span class="token punctuation">}</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">cells<span class="token operator">:</span> Cell<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>collection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Collection</span><span class="token punctuation">(</span>cells<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="renderer"><a href="#renderer" class="header-anchor">#</a> Renderer</h3> <p>渲染Model相关的数据</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Renderer</span> <span class="token keyword">extends</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
  <span class="token keyword">protected</span> views<span class="token operator">:</span> KeyValue<span class="token operator">&lt;</span>CellView<span class="token operator">&gt;</span>
  <span class="token keyword">protected</span> zPivots<span class="token operator">:</span> KeyValue<span class="token operator">&lt;</span>Comment<span class="token operator">&gt;</span>
  <span class="token keyword">protected</span> updates<span class="token operator">:</span> Renderer<span class="token punctuation">.</span>Updates
  <span class="token keyword">protected</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token function">startListening</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token function">stopListening</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token function">resetUpdates</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token function">onSortModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token function">onModelReseted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token function">onBatchStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token function">onCellAdded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token function">onCellRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token function">onCellZIndexChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token function">onCellVisibleChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token function">processEdgeOnTerminalVisibleChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token function">isEdgeTerminalVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="store"><a href="#store" class="header-anchor">#</a> Store</h3> <p>数据的公共存储仓库，与renderer进行交互</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Store</span><span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span> <span class="token keyword">extends</span> <span class="token class-name">Basecoat</span><span class="token operator">&lt;</span>Store<span class="token punctuation">.</span>EventArgs<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">protected</span> data<span class="token operator">:</span> <span class="token constant">D</span>
  <span class="token keyword">protected</span> previous<span class="token operator">:</span> <span class="token constant">D</span>
  <span class="token keyword">protected</span> changed<span class="token operator">:</span> Partial<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span>
  <span class="token keyword">protected</span> pending <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">protected</span> changing <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">protected</span> pendingOptions<span class="token operator">:</span> Store<span class="token punctuation">.</span>MutateOptions <span class="token operator">|</span> <span class="token keyword">null</span>
  <span class="token keyword">protected</span> mutate<span class="token operator">&lt;</span><span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">D</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token operator">:</span> Partial<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token constant">D</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span>ObjectExt<span class="token punctuation">.</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>changed <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="view"><a href="#view" class="header-anchor">#</a> View</h3> <p>聚合EdgeView、CellView等，使用了jQuery的相关DOM操作</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">View</span><span class="token operator">&lt;</span>EventArgs <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token keyword">extends</span> <span class="token class-name">Basecoat</span><span class="token operator">&lt;</span>EventArgs<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> cid<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token keyword">public</span> container<span class="token operator">:</span> Element
  <span class="token keyword">protected</span> selectors<span class="token operator">:</span> Markup<span class="token punctuation">.</span>Selectors

  <span class="token keyword">public</span> <span class="token keyword">get</span> <span class="token function">priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cid <span class="token operator">=</span> Private<span class="token punctuation">.</span><span class="token function">uniqueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    View<span class="token punctuation">.</span>views<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>cid<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="geometry"><a href="#geometry" class="header-anchor">#</a> Geometry</h3> <p>提供几何图形的操作处理，包括Curve、Ellipse、Line、Point、PolyLine、Rectangle、Angle等</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Geometry</span> <span class="token punctuation">{</span>
  <span class="token keyword">abstract</span> <span class="token function">scale</span><span class="token punctuation">(</span>
    sx<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    sy<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    origin<span class="token operator">?</span><span class="token operator">:</span> Point<span class="token punctuation">.</span>PointLike <span class="token operator">|</span> Point<span class="token punctuation">.</span>PointData<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span>

  <span class="token keyword">abstract</span> <span class="token function">rotate</span><span class="token punctuation">(</span>
    angle<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    origin<span class="token operator">?</span><span class="token operator">:</span> Point<span class="token punctuation">.</span>PointLike <span class="token operator">|</span> Point<span class="token punctuation">.</span>PointData<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span>

  <span class="token keyword">abstract</span> <span class="token function">translate</span><span class="token punctuation">(</span>tx<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> ty<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span>

  <span class="token keyword">abstract</span> <span class="token function">translate</span><span class="token punctuation">(</span>p<span class="token operator">:</span> Point<span class="token punctuation">.</span>PointLike <span class="token operator">|</span> Point<span class="token punctuation">.</span>PointData<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span>

  <span class="token keyword">abstract</span> <span class="token function">equals</span><span class="token punctuation">(</span>g<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span>

  <span class="token keyword">abstract</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Geometry

  <span class="token keyword">abstract</span> <span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> JSONObject <span class="token operator">|</span> JSONArray

  <span class="token keyword">abstract</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span>

  <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="registry"><a href="#registry" class="header-anchor">#</a> Registry</h3> <p>提供注册中心的机制，</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Registry</span><span class="token operator">&lt;</span>
  Entity<span class="token punctuation">,</span>
  Presets <span class="token operator">=</span> KeyValue<span class="token operator">&lt;</span>Entity<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  OptionalType <span class="token operator">=</span> <span class="token builtin">never</span><span class="token punctuation">,</span>
<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> data<span class="token operator">:</span> KeyValue<span class="token operator">&lt;</span>Entity<span class="token operator">&gt;</span>
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> options<span class="token operator">:</span> Registry<span class="token punctuation">.</span>Options<span class="token operator">&lt;</span>Entity <span class="token operator">|</span> OptionalType<span class="token operator">&gt;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token operator">:</span> Registry<span class="token punctuation">.</span>Options<span class="token operator">&lt;</span>Entity <span class="token operator">|</span> OptionalType<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>options <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>data <span class="token keyword">as</span> KeyValue<span class="token operator">&lt;</span>Entity<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>register <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>unregister <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unregister</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">names</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">unregister</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">exist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="events"><a href="#events" class="header-anchor">#</a> Events</h3> <p>提供事件的监听(发布订阅)机制</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Events</span><span class="token operator">&lt;</span>EventArgs <span class="token keyword">extends</span> <span class="token class-name">Events<span class="token punctuation">.</span>EventArgs</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> listeners<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token function">once</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token function">emit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>整体我们看到，要想实现一款底层的图编辑引擎，需要做好整体的架构设计及解构，通常不外乎MVC的结构的变种，因而我们在选择Model层、View层、Controller层的过程中，可以综合考虑软件工程中不同的设计方案来处理，比如对事件系统的设计、插件机制的设计等等，另外在底层渲染方面，毕竟作为图可视化领域的前端方案，对SVG、HTML、Canvas等不同方案的选择也需要针对性考虑，以上。可视化领域深度与广度探索起来不仅仅局限于前端侧，希望能够在这方面能够系统的学习与实践，从而探索出在前端领域的一些机会，共勉！！！</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://antv-x6.gitee.io/zh/" target="_blank" rel="noopener noreferrer">X6官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.jianshu.com/p/d497c0faa1b3" target="_blank" rel="noopener noreferrer">Antv/X6&lt;图编辑引擎&gt;<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/antvis/x6" target="_blank" rel="noopener noreferrer">x6源码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.jianshu.com/p/5a3a546de5ad" target="_blank" rel="noopener noreferrer">antvis G6 vs X6 vs Topology 源码统计分析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.yuque.com/antv/blog/2020x6" target="_blank" rel="noopener noreferrer">X6 1.0 抱歉来晚<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.yuque.com/antv/blog/2021xflow" target="_blank" rel="noopener noreferrer">XFlow 1.0：专业的图编辑应用解决方案<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.yuque.com/antv/blog/2021x6" target="_blank" rel="noopener noreferrer">X6：深度打磨，日臻完善<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.yuque.com/antv/blog/my10ko" target="_blank" rel="noopener noreferrer">AntV 旗下图编辑引擎 X6<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tech/front/imagepic20220128.html" class="prev">
        前端图床搭建实践（前端篇）
      </a></span> <span class="next"><a href="/tech/front/testus20220420.html">
        前端测试套件构建实践
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.8be0e0a6.js" defer></script><script src="/assets/js/2.984c461b.js" defer></script><script src="/assets/js/88.a6b02ad4.js" defer></script>
  </body>
</html>
