<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Web内容安全策略浅析 | VLeeDesignTheory</title>
    <meta name="description" content="The Intersection of Technology and Liberal Arts">
    <meta name="generator" content="VuePress 1.3.0">
    <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.ba29e539.css" as="style"><link rel="preload" href="/assets/js/app.8be0e0a6.js" as="script"><link rel="preload" href="/assets/js/2.984c461b.js" as="script"><link rel="preload" href="/assets/js/54.6a6a6edf.js" as="script"><link rel="prefetch" href="/assets/js/10.5cc39d1d.js"><link rel="prefetch" href="/assets/js/11.15cdb43e.js"><link rel="prefetch" href="/assets/js/12.06485937.js"><link rel="prefetch" href="/assets/js/13.472a2c29.js"><link rel="prefetch" href="/assets/js/14.d79a8704.js"><link rel="prefetch" href="/assets/js/15.61ac7c95.js"><link rel="prefetch" href="/assets/js/16.40e0624d.js"><link rel="prefetch" href="/assets/js/17.6d266b01.js"><link rel="prefetch" href="/assets/js/18.179e71a3.js"><link rel="prefetch" href="/assets/js/19.57b341aa.js"><link rel="prefetch" href="/assets/js/20.e9181ec2.js"><link rel="prefetch" href="/assets/js/21.064d76f4.js"><link rel="prefetch" href="/assets/js/22.03ef9be6.js"><link rel="prefetch" href="/assets/js/23.d8d3a89f.js"><link rel="prefetch" href="/assets/js/24.46d5ce43.js"><link rel="prefetch" href="/assets/js/25.e66d6d88.js"><link rel="prefetch" href="/assets/js/26.ffd8da2f.js"><link rel="prefetch" href="/assets/js/27.20da1fa0.js"><link rel="prefetch" href="/assets/js/28.5517996d.js"><link rel="prefetch" href="/assets/js/29.f6af6fbb.js"><link rel="prefetch" href="/assets/js/3.7b51d13c.js"><link rel="prefetch" href="/assets/js/30.fd905aa4.js"><link rel="prefetch" href="/assets/js/31.4d155fb1.js"><link rel="prefetch" href="/assets/js/32.daa14379.js"><link rel="prefetch" href="/assets/js/33.0c565322.js"><link rel="prefetch" href="/assets/js/34.a2469f4a.js"><link rel="prefetch" href="/assets/js/35.fe1e331d.js"><link rel="prefetch" href="/assets/js/36.acad7212.js"><link rel="prefetch" href="/assets/js/37.4be4688b.js"><link rel="prefetch" href="/assets/js/38.0ce5462f.js"><link rel="prefetch" href="/assets/js/39.eea49bbe.js"><link rel="prefetch" href="/assets/js/4.32c38324.js"><link rel="prefetch" href="/assets/js/40.909ed412.js"><link rel="prefetch" href="/assets/js/41.7b0f5165.js"><link rel="prefetch" href="/assets/js/42.c5847540.js"><link rel="prefetch" href="/assets/js/43.14eedcb7.js"><link rel="prefetch" href="/assets/js/44.40ed4222.js"><link rel="prefetch" href="/assets/js/45.29388d40.js"><link rel="prefetch" href="/assets/js/46.55b8a16d.js"><link rel="prefetch" href="/assets/js/47.668da14a.js"><link rel="prefetch" href="/assets/js/48.7cb06dcc.js"><link rel="prefetch" href="/assets/js/49.491d89f5.js"><link rel="prefetch" href="/assets/js/5.18d31a6e.js"><link rel="prefetch" href="/assets/js/50.1715183e.js"><link rel="prefetch" href="/assets/js/51.eb1ceda0.js"><link rel="prefetch" href="/assets/js/52.ab59a948.js"><link rel="prefetch" href="/assets/js/53.52dd242c.js"><link rel="prefetch" href="/assets/js/55.90a2d17a.js"><link rel="prefetch" href="/assets/js/56.e1281c58.js"><link rel="prefetch" href="/assets/js/57.d900cb38.js"><link rel="prefetch" href="/assets/js/58.4574e3c3.js"><link rel="prefetch" href="/assets/js/59.5f46f092.js"><link rel="prefetch" href="/assets/js/6.886d04e6.js"><link rel="prefetch" href="/assets/js/60.4fd77246.js"><link rel="prefetch" href="/assets/js/61.03c6d11f.js"><link rel="prefetch" href="/assets/js/62.6c4a2003.js"><link rel="prefetch" href="/assets/js/63.0e6902b9.js"><link rel="prefetch" href="/assets/js/64.0b83a931.js"><link rel="prefetch" href="/assets/js/65.96f2df30.js"><link rel="prefetch" href="/assets/js/66.744d9ab1.js"><link rel="prefetch" href="/assets/js/67.9837b758.js"><link rel="prefetch" href="/assets/js/68.dc9af8aa.js"><link rel="prefetch" href="/assets/js/69.445bac8e.js"><link rel="prefetch" href="/assets/js/7.fb7fa9c5.js"><link rel="prefetch" href="/assets/js/70.3c680b0e.js"><link rel="prefetch" href="/assets/js/71.4a662baa.js"><link rel="prefetch" href="/assets/js/72.1a286829.js"><link rel="prefetch" href="/assets/js/73.8d6b550c.js"><link rel="prefetch" href="/assets/js/74.fad5a0c5.js"><link rel="prefetch" href="/assets/js/75.0c5864ae.js"><link rel="prefetch" href="/assets/js/76.9a6ec209.js"><link rel="prefetch" href="/assets/js/77.8280bb93.js"><link rel="prefetch" href="/assets/js/78.3a2e4074.js"><link rel="prefetch" href="/assets/js/79.e18eb7f1.js"><link rel="prefetch" href="/assets/js/8.383d22ab.js"><link rel="prefetch" href="/assets/js/80.00c61c8a.js"><link rel="prefetch" href="/assets/js/81.8878bbce.js"><link rel="prefetch" href="/assets/js/82.f32b8403.js"><link rel="prefetch" href="/assets/js/83.c4c68d29.js"><link rel="prefetch" href="/assets/js/84.4edeeb08.js"><link rel="prefetch" href="/assets/js/85.e2c40980.js"><link rel="prefetch" href="/assets/js/86.cbdc4406.js"><link rel="prefetch" href="/assets/js/87.dd59cc6f.js"><link rel="prefetch" href="/assets/js/88.a6b02ad4.js"><link rel="prefetch" href="/assets/js/89.4edca4ad.js"><link rel="prefetch" href="/assets/js/9.842a26fc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ba29e539.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">VLeeDesignTheory</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计道" class="dropdown-title"><span class="title">设计道</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design/ui/" class="nav-link">
  交互
</a></li><li class="dropdown-item"><!----> <a href="/design/vi/" class="nav-link">
  视觉
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术栈" class="dropdown-title"><span class="title">技术栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tech/front/" class="nav-link router-link-active">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/tech/back/" class="nav-link">
  后端
</a></li><li class="dropdown-item"><!----> <a href="/tech/cs/" class="nav-link">
  基础
</a></li></ul></div></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试
</a></div><div class="nav-item"><a href="/essay/" class="nav-link">
  随笔
</a></div><div class="nav-item"><a href="https://github.com/we452366" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计道" class="dropdown-title"><span class="title">设计道</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design/ui/" class="nav-link">
  交互
</a></li><li class="dropdown-item"><!----> <a href="/design/vi/" class="nav-link">
  视觉
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术栈" class="dropdown-title"><span class="title">技术栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tech/front/" class="nav-link router-link-active">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/tech/back/" class="nav-link">
  后端
</a></li><li class="dropdown-item"><!----> <a href="/tech/cs/" class="nav-link">
  基础
</a></li></ul></div></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试
</a></div><div class="nav-item"><a href="/essay/" class="nav-link">
  随笔
</a></div><div class="nav-item"><a href="https://github.com/we452366" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech/front/summary.html" class="sidebar-link">从2019看2020前端发展趋势</a></li><li><a href="/tech/front/locales.html" class="sidebar-link">阿里飞冰(ice)框架下国际化实践</a></li><li><a href="/tech/front/tree20200531.html" class="sidebar-link">基础视频平台树组件踩坑实践</a></li><li><a href="/tech/front/range20200613.html" class="sidebar-link">基于el-slider自定义range组件封装实践</a></li><li><a href="/tech/front/hot20200620.html" class="sidebar-link">Vue脚手架热更新技术探秘</a></li><li><a href="/tech/front/tick20200625.html" class="sidebar-link">nextTick在项目中的实践</a></li><li><a href="/tech/front/cli20200701.html" class="sidebar-link">vee-cli脚手架实践(上)</a></li><li><a href="/tech/front/cli20200702.html" class="sidebar-link">vee-cli脚手架实践(中)</a></li><li><a href="/tech/front/cli20200703.html" class="sidebar-link">vee-cli脚手架实践(下)</a></li><li><a href="/tech/front/hooks20200826.html" class="sidebar-link">React Hooks在SD-WAN项目中实践</a></li><li><a href="/tech/front/flexiwan20201218.html" class="sidebar-link">flexiwan项目踩坑实践（前端篇）</a></li><li><a href="/tech/front/summary2020.html" class="sidebar-link">从2020看2021前端发展趋势</a></li><li><a href="/tech/front/federation20210119.html" class="sidebar-link">webpack5模块联邦源码探究</a></li><li><a href="/tech/front/topology20210122.html" class="sidebar-link">动态渲染拓扑图方案探究</a></li><li><a href="/tech/front/micro20210125.html" class="sidebar-link">几种微前端方案探究</a></li><li><a href="/tech/front/umi20210222.html" class="sidebar-link">umi3源码探究简析</a></li><li><a href="/tech/front/react20210305.html" class="sidebar-link">react17源码浅析</a></li><li><a href="/tech/front/screen20210402.html" class="sidebar-link">自服务大屏踩坑实践</a></li><li><a href="/tech/front/graph20210419.html" class="sidebar-link">可视化图布局算法浅析</a></li><li><a href="/tech/front/function20210427.html" class="sidebar-link">前端函数式编程浅析</a></li><li><a href="/tech/front/structure20210523.html" class="sidebar-link">数据结构算法在专网项目中的实践</a></li><li><a href="/tech/front/postmessage20210731.html" class="sidebar-link">postMessage踩坑实践</a></li><li><a href="/tech/front/csp20210813.html" class="active sidebar-link">Web内容安全策略浅析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/front/csp20210813.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/tech/front/csp20210813.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/tech/front/csp20210813.html#csp" class="sidebar-link">CSP</a></li><li class="sidebar-sub-header"><a href="/tech/front/csp20210813.html#案例" class="sidebar-link">案例</a></li><li class="sidebar-sub-header"><a href="/tech/front/csp20210813.html#源码" class="sidebar-link">源码</a></li><li class="sidebar-sub-header"><a href="/tech/front/csp20210813.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/tech/front/csp20210813.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/tech/front/pcx20211018.html" class="sidebar-link">PC端高倍屏适配方案实践</a></li><li><a href="/tech/front/summary2021.html" class="sidebar-link">从2021看2022前端发展趋势</a></li><li><a href="/tech/front/imagepic20220128.html" class="sidebar-link">前端图床搭建实践（前端篇）</a></li><li><a href="/tech/front/xsix20220305.html" class="sidebar-link">AntV X6源码简析</a></li><li><a href="/tech/front/testus20220420.html" class="sidebar-link">前端测试套件构建实践</a></li><li><a href="/tech/front/pnw20220608.html" class="sidebar-link">浅析专网通信领域的前端架构设计</a></li><li><a href="/tech/front/piper20220913.html" class="sidebar-link">前端设计走查平台实践（前端篇）</a></li><li><a href="/tech/front/summary2022.html" class="sidebar-link">从2022看2023前端发展趋势</a></li><li><a href="/tech/front/mpa20230217.html" class="sidebar-link">vue脚手架多页自动化生成实践</a></li><li><a href="/tech/front/gsix20230624.html" class="sidebar-link">AntV G6新版源码浅析</a></li><li><a href="/tech/front/pwa20230731.html" class="sidebar-link">面向边缘场景的PWA实践</a></li><li><a href="/tech/front/mock20230924.html" class="sidebar-link">基于 Webpack 插件体系的 Mock 服务</a></li><li><a href="/tech/front/summary2023.html" class="sidebar-link">从2023看2024前端发展趋势</a></li><li><a href="/tech/front/lcd20241024.html" class="sidebar-link">面向垂类场景的智能化低代码引擎</a></li><li><a href="/tech/front/summary2024.html" class="sidebar-link">从2024看2025前端发展趋势</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="web内容安全策略浅析"><a href="#web内容安全策略浅析" class="header-anchor">#</a> Web内容安全策略浅析</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>Web安全问题一直是前端领域一个绕不开的话题，但很多前端人员对Web的相关安全策略都只停留在面试过程中，本文主要是对上线过程中遇到的安全问题踩坑进行了一个总结，旨在对Web安全相关问题能有一个更为立体切身的体会，也希望能给大家提供一些踩坑时候的参考。</p> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <h3 id="xss-vs-csrf"><a href="#xss-vs-csrf" class="header-anchor">#</a> XSS vs CSRF</h3> <h4 id="xss"><a href="#xss" class="header-anchor">#</a> XSS</h4> <p>XSS是<a href="https://developer.mozilla.org/en-US/docs/Glossary/Cross-site_scripting" target="_blank" rel="noopener noreferrer">Cross-site scripting<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的缩写，为了和<a href="https://developer.mozilla.org/en-US/docs/Web/CSS" target="_blank" rel="noopener noreferrer">Cascading Style Sheets<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>进行区分，因而将其简写为XSS：</p> <blockquote><p>Cross-site scripting (XSS) is a security exploit which allows an attacker to inject into a website malicious client-side code. This code is executed by the victims and lets the attackers bypass access controls and impersonate users.</p></blockquote> <p>从MDN给出的定义可以看出，XSS是通过<code>inject(注入)</code>有害代码来实现攻击方案的，也就是说XSS的攻击方案是注入，这里一般是通过注入脚本，由于浏览器中dom、bom的为js提供了接口，因而js可以操作html和css，其也可以插入html片段等。</p> <h4 id="csrf"><a href="#csrf" class="header-anchor">#</a> CSRF</h4> <p>很多人分不清CSRF，其实他们还是有很大区别的，只不过通常会使用XSS拿到一些权限后才进行CSRF。CSRF是<a href="https://developer.mozilla.org/en-US/docs/Glossary/CSRF" target="_blank" rel="noopener noreferrer">Cross-Site Request Forgery<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的简写：</p> <blockquote><p>CSRF (Cross-Site Request Forgery) is an attack that impersonates a trusted user and sends a website unwanted commands.</p></blockquote> <p>从MDN定义可以看出来，CSRF是通过伪造来进行攻击，也就是其本质目的需要用一切手段来伪装自己获取本不属于它的权限资源</p> <h4 id="区别"><a href="#区别" class="header-anchor">#</a> 区别</h4> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">目的</th> <th style="text-align:center;">备注</th></tr></thead> <tbody><tr><td style="text-align:center;">XSS</td> <td style="text-align:center;">篡改内容</td> <td style="text-align:center;">不关心权限</td></tr> <tr><td style="text-align:center;">CSRF</td> <td style="text-align:center;">获取资源</td> <td style="text-align:center;">只关心权限</td></tr></tbody></table> <h3 id="xss分类"><a href="#xss分类" class="header-anchor">#</a> XSS分类</h3> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">存放</th> <th style="text-align:center;">侵入方式</th> <th style="text-align:center;">场景</th></tr></thead> <tbody><tr><td style="text-align:center;">存储型（持久型）</td> <td style="text-align:center;">后端数据库</td> <td style="text-align:center;">HTML</td> <td style="text-align:center;">带有用户保存数据的网站，如：论坛发帖、商品评论、用户私信</td></tr> <tr><td style="text-align:center;">反射型（非持久型）</td> <td style="text-align:center;">URL</td> <td style="text-align:center;">HTML</td> <td style="text-align:center;">网站搜索、跳转</td></tr> <tr><td style="text-align:center;">DOM 型</td> <td style="text-align:center;">后端数据库/前端存储/URL</td> <td style="text-align:center;">js</td> <td style="text-align:center;">前端js执行，如写了eval等</td></tr></tbody></table> <h3 id="xss防御方案"><a href="#xss防御方案" class="header-anchor">#</a> XSS防御方案</h3> <p>XSS预防主要分为两大部分：</p> <ol><li><p>防止攻击者提交恶意代码</p></li> <li><p>浏览器执行恶意代码</p></li></ol> <p>从这两大部分可以整理出不同的防范思路：</p> <table><thead><tr><th style="text-align:center;">方法</th> <th style="text-align:center;">步骤</th> <th style="text-align:center;">类型</th></tr></thead> <tbody><tr><td style="text-align:center;">利用模板引擎</td> <td style="text-align:center;">1</td> <td style="text-align:center;">存储型、反射型</td></tr> <tr><td style="text-align:center;">限制及转义输入</td> <td style="text-align:center;">1</td> <td style="text-align:center;">存储型、反射型</td></tr> <tr><td style="text-align:center;">限制js执行方法</td> <td style="text-align:center;">2</td> <td style="text-align:center;">DOM型</td></tr> <tr><td style="text-align:center;">Content Security Policy</td> <td style="text-align:center;">1、2</td> <td style="text-align:center;">存储型、反射型、DOM型</td></tr></tbody></table> <p>从上述列表可以看出，Content Security Policy对XSS的防范是比较好的，那么接下来就到了本文的重点内容，在下一part会重点介绍CSP相关的内容</p> <h2 id="csp"><a href="#csp" class="header-anchor">#</a> CSP</h2> <p><img src="/tech/front/csp20210813/csp04.png" alt="图片"></p> <p><a href="https://content-security-policy.com/" target="_blank" rel="noopener noreferrer">内容安全策略(Content Security Policy)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是现代浏览器安全机制中的一项重要内容，从图上可以看出除了老IE仅支持了csp的sandbox外，其他主流浏览器都已支持了csp，并且w3c也对整体做了统一的要求，具体可以参看w3c的官方文档<a href="https://www.w3.org/TR/CSP2/" target="_blank" rel="noopener noreferrer">Content Security Policy Level 2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h3> <p>Content-Security-Policy 是现代浏览器用来增强document安全性的一个响应头字段，其用来限制诸如js、css以及其他浏览器所需资源的加载。也就是说，csp的本质是一个限制资源加载的策略，其通过解析csp的指令及值进行具体资源的限制，具体的实现可以看最后一part源码中chromium的相关实现。另外除了在header添加csp外，在html的dom中也可以通过meta标签来进行限制，只是当二者所限制的资源指令及值都一样的时候，header中的优先级较高。</p> <h3 id="指令"><a href="#指令" class="header-anchor">#</a> 指令</h3> <table><thead><tr><th style="text-align:center;">指令</th> <th style="text-align:center;">版本</th> <th style="text-align:center;">注释</th></tr></thead> <tbody><tr><td style="text-align:center;">default-src</td> <td style="text-align:center;">1</td> <td style="text-align:center;">大部分资源未定义时会读取这个配置，少数不会，比如：frame-ancestors，优先级低</td></tr> <tr><td style="text-align:center;">script-src</td> <td style="text-align:center;">1</td> <td style="text-align:center;">定义有效的js资源</td></tr> <tr><td style="text-align:center;">style-src</td> <td style="text-align:center;">1</td> <td style="text-align:center;">定义有效的css资源</td></tr> <tr><td style="text-align:center;">img-src</td> <td style="text-align:center;">1</td> <td style="text-align:center;">定义有效的图片资源</td></tr> <tr><td style="text-align:center;">connect-src</td> <td style="text-align:center;">1</td> <td style="text-align:center;">加载XMLHttpRequest、WebSocket、fetch、<code>&lt;a ping&gt;</code>以及 EventSource资源，如果不被允许则返回400状态码</td></tr> <tr><td style="text-align:center;">font-src</td> <td style="text-align:center;">1</td> <td style="text-align:center;">定义有效的字体资源，通过@font-face加载</td></tr> <tr><td style="text-align:center;">object-src</td> <td style="text-align:center;">1</td> <td style="text-align:center;">定义有效的插件资源，比如：<code>&lt;object&gt;</code>，<code>&lt;embed&gt;</code>或者<code>&lt;applet&gt;</code></td></tr> <tr><td style="text-align:center;">media-src</td> <td style="text-align:center;">1</td> <td style="text-align:center;">定义有效的音频及视频资源，比如：<code>&lt;audio&gt;</code>，<code>&lt;video&gt;</code>等元素</td></tr> <tr><td style="text-align:center;">frame-src</td> <td style="text-align:center;">1</td> <td style="text-align:center;">定义有效的frame加载资源，在csp2中，frame-src被废弃，使用child-src；在csp3中，又被启用，与child-src同时存在，如果child-src不存在，frame-src也会起作用</td></tr> <tr><td style="text-align:center;">sandbox</td> <td style="text-align:center;">1</td> <td style="text-align:center;">允许iframe的sandbox属性，sandbox会采用同源策略，阻止弹窗、插件及脚本执行，可以通过不设置sandbox属性，而是通过allow-scripts、allow-popups、allow-modals、allow-orientation-lock、allow-pointer-lock、allow-presentation、allow-popups-to-escape-sandbox、allow-top-navigation来透给sandbox字段限制</td></tr> <tr><td style="text-align:center;">report-uri</td> <td style="text-align:center;">1</td> <td style="text-align:center;">向这个uri发送失败报告，也可以使用Content-Security-Policy-Report-Only来作为http header进行发送但不阻塞网络资源的解析，在csp3中report-uri被废弃，改用report-to指令</td></tr> <tr><td style="text-align:center;">child-src</td> <td style="text-align:center;">2</td> <td style="text-align:center;">定义web workers以及包含嵌套上下文的资源加载，比如<code>&lt;frame&gt;</code>以及<code>&lt;iframe&gt;</code></td></tr> <tr><td style="text-align:center;">form-action</td> <td style="text-align:center;">2</td> <td style="text-align:center;">定义有效的html标签<code>&lt;form&gt;</code>的action资源加载</td></tr> <tr><td style="text-align:center;">frame-ancestors</td> <td style="text-align:center;">2</td> <td style="text-align:center;">定义有效内嵌标签诸如<code>&lt;frame&gt;</code>、<code>&lt;iframe&gt;</code>、<code>&lt;object&gt;</code>、<code>&lt;embd&gt;</code>、<code>&lt;applet&gt;</code>资源加载，当值为'none'时，大致可以和X-Frame-Options: DENY相当</td></tr> <tr><td style="text-align:center;">plugin-types</td> <td style="text-align:center;">2</td> <td style="text-align:center;">定义通过<code>&lt;object&gt;</code>及<code>&lt;embd&gt;</code>的MIME资源类型加载，对于<code>&lt;applet&gt;</code>则必须明确MIME为application/x-java-applet</td></tr> <tr><td style="text-align:center;">base-uri</td> <td style="text-align:center;">2</td> <td style="text-align:center;">定义通过<code>&lt;base&gt;</code>的html标签中的src属性引用的url资源加载</td></tr> <tr><td style="text-align:center;">report-to</td> <td style="text-align:center;">3</td> <td style="text-align:center;">定义Report-To的http响应头字段</td></tr> <tr><td style="text-align:center;">worker-src</td> <td style="text-align:center;">3</td> <td style="text-align:center;">限制通过Worker、SharedWorker以及ServiceWorker的url资源加载</td></tr> <tr><td style="text-align:center;">manifest-src</td> <td style="text-align:center;">3</td> <td style="text-align:center;">限制manifests的url资源加载</td></tr> <tr><td style="text-align:center;">prefetch-src</td> <td style="text-align:center;">3</td> <td style="text-align:center;">定义预渲染及预加载请求的资源加载，比如通过<code>&lt;link&gt;</code>标签的rel=&quot;prefetch&quot;或rel=&quot;prerender&quot;属性</td></tr> <tr><td style="text-align:center;">navigate-to</td> <td style="text-align:center;">3</td> <td style="text-align:center;">限制document的任何方式跳转url，比如通过link跳转，或者window.location被执行，如果form-action被设置，则本规则会被替换，即对于form而言，form-action优先级更高</td></tr></tbody></table> <h3 id="值"><a href="#值" class="header-anchor">#</a> 值</h3> <table><thead><tr><th style="text-align:center;">值</th> <th style="text-align:center;">版本</th> <th style="text-align:center;">描述</th> <th style="text-align:center;">样例</th></tr></thead> <tbody><tr><td style="text-align:center;">*</td> <td style="text-align:center;">1</td> <td style="text-align:center;">未知，允许除了data、blob、filesystem、schemes之外的任何url资源加载</td> <td style="text-align:center;">img-src *</td></tr> <tr><td style="text-align:center;">'none'</td> <td style="text-align:center;">1</td> <td style="text-align:center;">不允许加载任何的资源</td> <td style="text-align:center;">object-src 'none'</td></tr> <tr><td style="text-align:center;">'self'</td> <td style="text-align:center;">1</td> <td style="text-align:center;">只允许同源资源加载</td> <td style="text-align:center;">script-src 'self'</td></tr> <tr><td style="text-align:center;">'data:'</td> <td style="text-align:center;">1</td> <td style="text-align:center;">允许data格式的资源加载，比如：Base64图片编码</td> <td style="text-align:center;">img-src 'self' data:</td></tr> <tr><td style="text-align:center;">xx.xxx.com</td> <td style="text-align:center;">1</td> <td style="text-align:center;">允许明确域名的资源加载</td> <td style="text-align:center;">img-src domain.example.com</td></tr> <tr><td style="text-align:center;">*.xxx.com</td> <td style="text-align:center;">1</td> <td style="text-align:center;">允许加载任何例如：example.com子域下的资源</td> <td style="text-align:center;">img-src *.example.com</td></tr> <tr><td style="text-align:center;">https://xxx.com</td> <td style="text-align:center;">1</td> <td style="text-align:center;">仅允许https协议下域名的资源加载</td> <td style="text-align:center;">img-src https://cdn.com</td></tr> <tr><td style="text-align:center;">https:</td> <td style="text-align:center;">1</td> <td style="text-align:center;">允许加载https下任何域名的资源</td> <td style="text-align:center;">img-src https:</td></tr> <tr><td style="text-align:center;">'unsafe-inline'</td> <td style="text-align:center;">1</td> <td style="text-align:center;">允许使用内联元素加载资源，诸如：级联样式、句柄方法、script内容标签以及javascript:URIs等</td> <td style="text-align:center;">script-src 'unsafe-inline'</td></tr> <tr><td style="text-align:center;">'unsafe-eval'</td> <td style="text-align:center;">1</td> <td style="text-align:center;">允许不安全的动态js代码执行</td> <td style="text-align:center;">script-src 'unsafe-eval'</td></tr> <tr><td style="text-align:center;">'sha256-'</td> <td style="text-align:center;">2</td> <td style="text-align:center;">允许内联script及css匹配hash值后的执行</td> <td style="text-align:center;">script-src 'sha256-xyz...'</td></tr> <tr><td style="text-align:center;">'nonce-'</td> <td style="text-align:center;">2</td> <td style="text-align:center;">允许使用包含nonce属性的内联script及css执行，nonce应该是一个安全的任意值，并且不能被重复使用</td> <td style="text-align:center;">script-src 'nonce-r@nd0m'</td></tr> <tr><td style="text-align:center;">'strict-dynamic'</td> <td style="text-align:center;">3</td> <td style="text-align:center;">允许加载非解析型脚本资源，比如：document.createElement('script')</td> <td style="text-align:center;">script-src 'strict-dynamic'</td></tr> <tr><td style="text-align:center;">'unsafe-hashes'</td> <td style="text-align:center;">3</td> <td style="text-align:center;">允许使用事件句柄的方式进行资源加载，但是不允许使用内联脚本及javascript:执行的方式</td> <td style="text-align:center;">script-src 'unsafe-hashes' 'sha256-abc...'</td></tr></tbody></table> <h2 id="案例"><a href="#案例" class="header-anchor">#</a> 案例</h2> <p>通过上一part的介绍，我们大致了解了CSP相关一些用法，下面具体看一下在前端业务中的具体实践</p> <h3 id="nginx"><a href="#nginx" class="header-anchor">#</a> nginx</h3> <p><img src="/tech/front/csp20210813/csp03.png" alt="图片"></p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span> <span class="token number">9080</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
    <span class="token keyword">add_header</span> Content<span class="token operator">-</span>Security<span class="token operator">-</span>Policy <span class="token string">&quot;default-src 'self'; script-src 'self'; frame-ancestors 'self'; object-src 'none'&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">add_header</span> X<span class="token operator">-</span>Content<span class="token operator">-</span>Type<span class="token operator">-</span>Options nosniff<span class="token punctuation">;</span>
    <span class="token keyword">add_header</span> X<span class="token operator">-</span>Frame<span class="token operator">-</span>Options SAMEORIGIN<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们先来看一下nginx中的所有都严格控制的情况，我们再console中的v8实例下，使用创建一个标签来测试一下</p> <p><img src="/tech/front/csp20210813/csp01.png" alt="图片"></p> <p>这时我们发现，浏览器中报了</p> <blockquote><p>Refused to apply xxx because it violates the following Content Security Policy directive...</p></blockquote> <p>的错误；同时，我们打开任意一个network中的请求连接，我们发现，在响应头中，出现了</p> <p><img src="/tech/front/csp20210813/csp02.png" alt="图片"></p> <p>如上图所示的<code>Content-Security-Policy: xxx</code>的字段</p> <p>接着，我们根据返回的错误，进行适度的csp限制放开</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span> <span class="token number">9080</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
    <span class="token keyword">add_header</span> Content<span class="token operator">-</span>Security<span class="token operator">-</span>Policy <span class="token string">&quot;default-src *; script-src * 'unsafe-inline' 'unsafe-eval'; img-src * data:;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">add_header</span> X<span class="token operator">-</span>Content<span class="token operator">-</span>Type<span class="token operator">-</span>Options nosniff<span class="token punctuation">;</span>
    <span class="token keyword">add_header</span> X<span class="token operator">-</span>Frame<span class="token operator">-</span>Options SAMEORIGIN<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改过后，发现之前的报错消失了，测试成功</p> <h3 id="html"><a href="#html" class="header-anchor">#</a> html</h3> <p>最后，我们来看一下html中meta标签的一个使用情况</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Content-Security-Policy<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>default-src *; script-src 'unsafe-inline' 'unsafe-eval'; img-src *;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Cache-Control<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>no-cache, no-store, must-revalidate<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Pragma<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>no-cache<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Expires<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>format-detection<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>telephone=no<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width,initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>&lt;%= BASE_URL %&gt;favicon.ico<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>&lt;%= htmlWebpackPlugin.options.title %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>noscript</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span>
        <span class="token punctuation">&gt;</span></span>We're sorry but &lt;%= htmlWebpackPlugin.options.title %&gt; doesn't work properly without
        JavaScript enabled. Please enable it to continue.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span>
      <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>noscript</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- built files will be auto injected --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在不使用nginx配置csp的情况下，在html中配置meta也是可以起到同样的作用，但是当二者同时存在且字段一致时，会优先解析header中的响应</p> <h2 id="源码"><a href="#源码" class="header-anchor">#</a> 源码</h2> <p><img src="/tech/front/csp20210813/csp05.png" alt="图片"></p> <p>这一part我们通过chromium源码来看一下chrome中是如何实现CSP的</p> <h3 id="content-security-policy-parsers"><a href="#content-security-policy-parsers" class="header-anchor">#</a> content_security_policy_parsers</h3> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">bool</span> <span class="token function">IsCSPDirectiveNameCharacter</span><span class="token punctuation">(</span>UChar c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">IsASCIIAlpanumeric</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">||</span> c <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">IsCSPDirectiveValueCharacter</span><span class="token punctuation">(</span>UChar c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">IsASCIISpace</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">IsASCIIPrintable</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> c <span class="token operator">!=</span> <span class="token string">','</span> <span class="token operator">&amp;&amp;</span> c <span class="token operator">!=</span> <span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在network中通过解析key-value值对Content-Security-Policy中的指令及值进行获取</p> <h3 id="resource-fetcher"><a href="#resource-fetcher" class="header-anchor">#</a> resource_fetcher</h3> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">bool</span> ResourceFetcher<span class="token operator">::</span><span class="token function">ResourceNeedsLoad</span><span class="token punctuation">(</span>Resource<span class="token operator">*</span> resource<span class="token punctuation">,</span> <span class="token keyword">const</span> FetchParameters<span class="token operator">&amp;</span> params<span class="token punctuation">,</span> RevalidationPolicy policy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>archive_<span class="token punctuation">)</span> 
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span><span class="token punctuation">(</span>resource<span class="token operator">-&gt;</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> ResourceType<span class="token operator">::</span>kFont <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>params<span class="token punctuation">.</span><span class="token function">IsLinkPreload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span><span class="token punctuation">(</span>resource<span class="token operator">-&gt;</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> ResourceType<span class="token operator">::</span>kImage <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">ShouldDeferImageLoad</span><span class="token punctuation">(</span>resource<span class="token operator">-&gt;</span><span class="token function">Url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> params<span class="token punctuation">.</span><span class="token function">GetImageRequestBehavior</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> FetchParameters<span class="token operator">::</span>kDeferImageLoad<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> policy <span class="token operator">!=</span> RevalidationPolicy<span class="token operator">::</span>kUse <span class="token operator">||</span> resource<span class="token operator">-&gt;</span><span class="token function">StillNeedsLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对是否进行资源加载进行判断</p> <h3 id="http-equiv"><a href="#http-equiv" class="header-anchor">#</a> http_equiv</h3> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> HttpEquiv<span class="token operator">::</span><span class="token function">ProcessHttpEquivContentSecurityPolicy</span><span class="token punctuation">(</span>LocalDOMWindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword">const</span> AtomicString<span class="token operator">&amp;</span> equiv<span class="token punctuation">,</span> <span class="token keyword">const</span> AtomicString<span class="token operator">&amp;</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>window <span class="token operator">||</span> <span class="token operator">!</span>window<span class="token operator">-&gt;</span><span class="token function">GetFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token operator">-&gt;</span><span class="token function">GetFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">GetSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">GetBypassCSP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">EqualIgnoringASCIICase</span><span class="token punctuation">(</span>equiv<span class="token punctuation">,</span> <span class="token string">&quot;content-security-policy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Vector<span class="token operator">&lt;</span>network<span class="token operator">::</span>mojom<span class="token operator">::</span>blink<span class="token operator">::</span>ContentSecurityPolicyPtr<span class="token operator">&gt;</span> parsed <span class="token operator">=</span> <span class="token function">ParseContentSecurityPolicies</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> network<span class="token operator">::</span>mojom<span class="token operator">::</span>blink<span class="token operator">::</span>ContentSecurityPolicyType<span class="token operator">::</span>kEnforce<span class="token punctuation">,</span> network<span class="token operator">::</span>mojom<span class="token operator">::</span>blink<span class="token operator">::</span>ContentSecurityPolicySource<span class="token operator">::</span>kMeta<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>window<span class="token operator">-&gt;</span><span class="token function">GetSecurityOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        window<span class="token operator">-&gt;</span><span class="token function">GetContentSecurityPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">AddPolicies</span><span class="token punctuation">(</span>mojo<span class="token operator">::</span><span class="token function">Clone</span><span class="token punctuation">(</span>parsed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        window<span class="token operator">-&gt;</span><span class="token function">GetPolicyContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">AddContentSecurityPolicies</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">move</span><span class="token punctuation">(</span>parsed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">EqualIgnoringASCIICase</span><span class="token punctuation">(</span>equiv<span class="token punctuation">,</span> <span class="token string">&quot;content-security-policy-report-only&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token operator">-&gt;</span><span class="token function">GetContentSecurityPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">ReportReportOnlyInMeta</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">NOTREACHED</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们看到在Document中执行相关csp的一些逻辑</p> <h3 id="worker-content-settings-client"><a href="#worker-content-settings-client" class="header-anchor">#</a> worker_content_settings_client</h3> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">bool</span> WorkerContentSettingsClient<span class="token operator">::</span><span class="token function">AllowScriptFromSource</span><span class="token punctuation">(</span><span class="token keyword">bool</span> enabled_per_settings<span class="token punctuation">,</span> <span class="token keyword">const</span> blink<span class="token operator">::</span>WebURL<span class="token operator">&amp;</span> script_url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">bool</span> allow <span class="token operator">=</span> enabled_per_settings<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>allow <span class="token operator">&amp;&amp;</span> content_setting_rules_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        GURL top_frame_origin_url <span class="token operator">=</span> top_frame_origin_<span class="token punctuation">.</span><span class="token function">GetURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> rule<span class="token operator">:</span> content_setting_rules_<span class="token operator">-&gt;</span>script_rules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>rule<span class="token punctuation">.</span>primary_pattern<span class="token punctuation">.</span><span class="token function">Matches</span><span class="token punctuation">(</span>top_frame_origin_url<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> rule<span class="token punctuation">.</span>secondary_pattern<span class="token punctuation">.</span><span class="token function">Matches</span><span class="token punctuation">(</span>script_url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                allow <span class="token operator">=</span> rule<span class="token punctuation">.</span><span class="token function">GetContentSetting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> CONTENT_SETTING_BLOCK<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>allow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">EnsureContentSettingsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        content_settings_manager_<span class="token operator">-&gt;</span><span class="token function">OnContentBlocked</span><span class="token punctuation">(</span>render_frame_id_<span class="token punctuation">,</span> ContentSettingsType<span class="token operator">::</span>JAVASCRIPT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最后，我们可以简单看一下是否允许加载content的一些逻辑，以script加载为例</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p><img src="/tech/front/csp20210813/csp06.jpg" alt="图片"></p> <p>不论是否是it行业，只要是工程师，都需要对工程项目中的安全问题进行相关的重视，对于前端工程来说，常见的XSS、CSRF等相关知识也需要我们在实际工程项目中进行原理探索，以及对常见的解决方案能够做到了熟于心，这样在架构设计及工程实践过程中才能做到应用工程的稳定可持续，最后附上一张chrome中的xss信息的ER图，从中体会一下chrome对于安全问题的架构设计及信息链路把控的优秀与严谨</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Cross-site_scripting" target="_blank" rel="noopener noreferrer">Cross-site scripting<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://tech.meituan.com/2018/09/27/fe-security.html" target="_blank" rel="noopener noreferrer">前端安全系列（一）：如何防止XSS攻击？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html" target="_blank" rel="noopener noreferrer">前端安全系列（二）：如何防止CSRF攻击？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/itsuibi/p/10752868.html" target="_blank" rel="noopener noreferrer">xss攻击和csrf攻击的定义及区别<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mp.weixin.qq.com/s/GMA2OpBLtRTEU2E2DoE_iQ" target="_blank" rel="noopener noreferrer">【第849期】如何让前端更安全？——XSS攻击和防御详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.cn/post/6844904095711494151" target="_blank" rel="noopener noreferrer">预测最近面试会考 Cookie 的 SameSite 属性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy" target="_blank" rel="noopener noreferrer">Content-Security-Policy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/qq_37943295/article/details/79978761" target="_blank" rel="noopener noreferrer">内容安全策略（CSP）详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/qq_35606400/article/details/114986532" target="_blank" rel="noopener noreferrer">CHROME扩展笔记之拒绝unsafe-eval求值<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/lmh2072005/p/6044542.html" target="_blank" rel="noopener noreferrer">CSP内容安全策略<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://nginx.org/en/docs/http/ngx_http_headers_module.html" target="_blank" rel="noopener noreferrer">Module ngx_http_headers_module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://content-security-policy.com/" target="_blank" rel="noopener noreferrer">Content Security Policy Reference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.w3.org/TR/CSP2/" target="_blank" rel="noopener noreferrer">Content Security Policy Level 2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://book.douban.com/subject/25910556/" target="_blank" rel="noopener noreferrer">WebKit技术内幕<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/Arui_0/article/details/108382750" target="_blank" rel="noopener noreferrer">前端的CSP &amp; CSP如何落地，了解一下<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tech/front/postmessage20210731.html" class="prev">
        postMessage踩坑实践
      </a></span> <span class="next"><a href="/tech/front/pcx20211018.html">
        PC端高倍屏适配方案实践
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.8be0e0a6.js" defer></script><script src="/assets/js/2.984c461b.js" defer></script><script src="/assets/js/54.6a6a6edf.js" defer></script>
  </body>
</html>
